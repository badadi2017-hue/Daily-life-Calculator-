<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily Life Calculator</title>
<meta name="color-scheme" content="light dark">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
/* --- VARIABLES (Apple iOS Glass) --- */
:root {
  --orb1: #007AFF; 
  --orb2: #AF52DE; 
  --bg-base: #F2F2F7;
  --text: #000000;
  --text-sec: #3C3C4399;
  --glass-card: rgba(255, 255, 255, 0.65);
  --glass-border: rgba(255, 255, 255, 0.4);
  --glass-input: rgba(118, 118, 128, 0.12);
  --glass-menu: rgba(249, 249, 249, 0.94);
  --accent: #007AFF; 
  --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.08);
  --danger: #FF3B30;
  --warn: #FF9500;
  --c-hour: #007AFF; --c-min: #34C759; --c-sec: #FF3B30;
  --emi-principal: #34C759; --emi-interest: #FF3B30;
}

body.dark {
  --orb1: #0A84FF; --orb2: #BF5AF2; --bg-base: #000000;
  --text: #FFFFFF; --text-sec: #EBEBF599;
  --glass-card: rgba(30, 30, 30, 0.60); 
  --glass-border: rgba(255, 255, 255, 0.1);
  --glass-input: rgba(118, 118, 128, 0.24);
  --glass-menu: rgba(25, 25, 25, 0.94);
  --danger: #FF453A; --warn: #FF9F0A;
  --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

html, body { 
  margin: 0; padding: 0; width: 100%; height: 100dvh; 
  overflow: hidden; position: fixed; 
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
  background: var(--bg-base); color: var(--text); transition: background 0.3s; 
}

i { vertical-align: middle; line-height: 1; }

@keyframes sectionSlideUp {
  0% { opacity: 0; transform: translateY(30px) scale(0.98); filter: blur(5px); }
  100% { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
}

.bg-mesh { position: absolute; width: 100%; height: 100%; z-index: -2; background: radial-gradient(circle at 0% 0%, var(--orb1), transparent 60%), radial-gradient(circle at 100% 100%, var(--orb2), transparent 60%); opacity: 0.25; filter: blur(80px); animation: pulse 10s ease-in-out infinite alternate; }
@keyframes pulse { 0%{opacity:0.25;} 100%{opacity:0.4;} }

.floater { position: absolute; border-radius: 50%; filter: blur(40px); z-index: -1; opacity: 0.4; animation: float 20s infinite ease-in-out; }
.f1 { width: 200px; height: 200px; background: var(--orb1); top: 10%; left: 10%; animation-duration: 25s; }
.f2 { width: 250px; height: 250px; background: var(--orb2); bottom: 10%; right: 10%; animation-duration: 28s; animation-delay: -5s; }
.f3 { width: 150px; height: 150px; background: #34C759; top: 40%; left: 60%; animation-duration: 32s; animation-delay: -10s; opacity: 0.2; }
@keyframes float { 0%, 100% { transform: translate(0, 0); } 33% { transform: translate(30px, -50px); } 66% { transform: translate(-20px, 20px); } }

/* --- VERSION TAG STYLE --- */
.menu-version-top {
  position: absolute;
  top: 22px;
  right: 20px;
  font-size: 10px;
  font-weight: 800;
  color: var(--accent);
  background: var(--glass-input);
  padding: 4px 10px;
  border-radius: 20px;
  text-transform: uppercase;
  letter-spacing: 1px;
  border: 0.5px solid var(--glass-border);
  backdrop-filter: blur(5px);
  z-index: 10;
}

/* --- GLOBAL BUTTON PINCH EFFECT --- */
.ui-btn, .q-card, .mini-btn, .lang-btn, .side-menu button, .swap-btn, .q-icon, .app input, .app select {
  transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1) !important;
}
.ui-btn:active, .q-card:active, .mini-btn:active, .lang-btn:active, .side-menu button:active, .swap-btn:active, .app input:focus {
  transform: scale(0.92) !important; 
}

/* --- WELCOME ANIMATION STYLES --- */
.welcome-overlay {
  position: fixed; inset: 0; background: var(--bg-base); z-index: 9999;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  transition: opacity 0.8s ease, visibility 0.8s;
}
.welcome-logo {
  font-size: 38px; font-weight: 800; color: var(--accent); letter-spacing: -1px;
  animation: welcomePop 1.2s cubic-bezier(0.17, 0.67, 0.83, 0.67) forwards;
}
.welcome-tagline {
  font-size: 14px; font-weight: 600; color: var(--text-sec); margin-top: 10px; opacity: 0;
  animation: fadeIn 0.5s ease 0.8s forwards;
}
@keyframes welcomePop {
  0% { transform: scale(0.6) translateY(20px); opacity: 0; filter: blur(10px); }
  100% { transform: scale(1) translateY(0); opacity: 1; filter: blur(0); }
}
.welcome-overlay.fade-out { opacity: 0; visibility: hidden; pointer-events: none; }

.ui-btn { 
  position: fixed; 
  top: max(12px, env(safe-area-inset-top)); 
  width: 44px; height: 44px; border: none; border-radius: 50%; 
  background: var(--glass-card); backdrop-filter: blur(20px); 
  -webkit-backdrop-filter: blur(20px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
  color: var(--text); font-size: 22px; display: flex; align-items: center; 
  justify-content: center; cursor: pointer; z-index: 5000; 
}

.settings-btn { right: 12px; }
.settings-btn.active { transform: rotate(90deg) scale(1.1); }
.home-nav-btn { right: 68px; display: none; }
.hamburger { left: 12px; flex-direction: column; gap: 5px; }
.hamburger span { width: 20px; height: 2px; background: var(--text); border-radius: 2px; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); transform-origin: center; }

body.menu-open .hamburger span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
body.menu-open .hamburger span:nth-child(2) { opacity: 0; transform: scale(0); }
body.menu-open .hamburger span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

.settings-modal { position: fixed; top: 68px; right: 12px; width: 190px; background: var(--glass-menu); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 0.5px solid var(--glass-border); border-radius: 18px; padding: 14px; z-index: 4000; display: none; opacity: 0; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--shadow); transform: translateY(-10px); }
.settings-modal.active { display: block; opacity: 1; transform: translateY(0); }
.modal-overlay { position: fixed; inset: 0; background: transparent; display: none; z-index: 3500; }
.setting-item { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
.setting-item span { font-weight: 600; color: var(--text-sec); font-size: 13px; }

.mini-btn { padding: 6px 14px; font-size: 14px; font-weight: 700; background: var(--glass-input); color: var(--accent); border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 4px; }

.side-menu { position: fixed; top: 0; left: -280px; width: 260px; height: 100%; background: var(--glass-menu); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border-right: 0.5px solid var(--glass-border); padding: 80px 20px 20px; box-shadow: 10px 0 40px rgba(0,0,0,0.1); transition: 0.35s cubic-bezier(0.32, 0.72, 0, 1); z-index: 2500; overflow-y: auto; }
#menuList { display: flex; flex-direction: column; }
.side-menu button { width: 100%; padding: 16px 20px; margin-bottom: 10px; border: none; border-radius: 14px; background: transparent; color: var(--text); font-size: 17px; font-weight: 600; text-align: left; cursor: pointer; transition: background 0.2s; touch-action: none; display: flex; align-items: center; gap: 12px; }
.side-menu button i { color: var(--accent); font-size: 20px; }

.overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.2); backdrop-filter: blur(5px); display: none; z-index: 2000; }
body.menu-open .side-menu { left: 0; }
body.menu-open .overlay { display: block; }

.section { 
  display: none; width: 100%; height: 100%; 
  padding: 70px 12px 350px; 
  flex-direction: column; align-items: center; 
  overflow-y: auto; -webkit-overflow-scrolling: touch; 
}
.section.active { display: flex; animation: sectionSlideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

#home { justify-content: flex-start; padding-top: 100px; padding-bottom: 20px; }
.greeting { font-size: 28px; font-weight: 700; color: var(--text); margin-bottom: 10px; text-align: center; opacity: 0; animation: fadeIn 1s forwards; }
@keyframes fadeIn { from{opacity:0; transform:translateY(-10px);} to{opacity:1; transform:translateY(0);} }

.clock-wrap { display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 20px 0; }
.ring-clock { position: relative; width: 280px; height: 280px; border-radius: 50%; background: var(--glass-card); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); box-shadow: var(--shadow); border: 0.5px solid var(--glass-border); display: flex; align-items: center; justify-content: center; }
svg { position: absolute; width: 100%; height: 100%; transform: rotate(-90deg); z-index: 1; }
circle { fill: none; stroke-linecap: round; transition: stroke-dashoffset 0.1s linear; }
.sec { stroke: var(--c-sec); filter: drop-shadow(0 0 6px var(--c-sec)); }
.min { stroke: var(--c-min); }
.hour { stroke: var(--c-hour); }
.digital-wrap { margin-top: 0; text-align: center; z-index: 10; position: relative; }
.digital { font-size: 52px; font-weight: 300; color: var(--text); letter-spacing: -1px; }
.date { font-size: 16px; font-weight: 500; color: var(--text-sec); margin-top: 2px; text-transform: uppercase; }
.bn-date { font-size: 15px; font-weight: 700; color: var(--accent); margin-top: 4px; }

.quick-links { display: flex; gap: 12px; margin-top: 40px; width: 100%; max-width: 320px; justify-content: center; }
.q-card { flex: 1; background: var(--glass-card); border: 0.5px solid var(--glass-border); border-radius: 16px; padding: 12px; text-align: center; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center; gap: 6px; }
.q-icon { font-size: 28px; color: var(--accent); }
.q-name { font-size: 11px; font-weight: 600; color: var(--text-sec); }

.mini-clock { display: flex; gap: 4px; align-items: center; justify-content: center; margin-bottom: 14px; transform: scale(1.1); }
.mc-card { background: var(--glass-input); border: 0.5px solid var(--glass-border); backdrop-filter: blur(12px); padding: 6px 8px; border-radius: 8px; font-size: 18px; font-weight: 700; font-family: 'Courier New', monospace; color: var(--text); box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
.mc-sep { font-size: 18px; color: var(--text-sec); animation: blink 1s infinite; }
.mc-ampm { font-size: 11px; color: var(--text-sec); margin-left: 4px; font-weight: 700; text-transform: uppercase; margin-top: 6px; }
@keyframes blink { 50% { opacity: 0; } }

.app { width: 100%; max-width: 400px; background: var(--glass-card); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 0.5px solid var(--glass-border); border-radius: 18px; box-shadow: var(--shadow); padding: 16px; display: flex; flex-direction: column; gap: 10px; margin-bottom: 30px; }
.header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.header-row h2 { margin: 0; font-size: 18px; font-weight: 700; color: var(--text); letter-spacing: -0.5px; }

.btn-group { display: flex; gap: 6px; }
.lang-btn { padding: 6px 10px; font-size: 16px; font-weight: 600; background: var(--glass-input); color: var(--accent); border: none; border-radius: 100px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
.clear-btn { background: rgba(255, 59, 48, 0.1); color: var(--danger); }
.undo-btn { background: rgba(255, 149, 0, 0.1); color: var(--warn); }
.share-btn { background: rgba(0, 122, 255, 0.1); color: var(--accent); }
.voice-btn { background: rgba(52, 199, 89, 0.1); color: #34C759; }

.swap-btn { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--glass-border); background: var(--glass-input); color: var(--accent); font-size: 20px; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; align-self: flex-end; margin-bottom: 4px; }

label { font-size: 11px; font-weight: 600; color: var(--text-sec); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; margin-left: 4px; display: block; }
input, select { width: 100%; height: 42px; padding: 0 12px; background: var(--glass-input); border: none; border-radius: 10px; color: var(--text); font-size: 17px; outline: none; transition: 0.2s; font-family: inherit; }
input:focus, select:focus { background: var(--glass-input); box-shadow: 0 0 0 2px var(--accent); }
input::placeholder { opacity: 0.2; }

.row { display: flex; gap: 10px; }
.row > div { flex: 1; }
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.box { padding: 10px; text-align: center; background: var(--glass-input); border-radius: 12px; }
.box span:first-child { font-size: 11px; color: var(--text-sec); }
.total { display: block; font-size: 18px; font-weight: 700; color: var(--text); margin-top: 2px; }
.box-compact { padding: 6px 8px; border-radius: 10px; }

.info-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 12px; margin-bottom: 6px; background: var(--glass-input); border-radius: 10px; }
.info-label { font-size: 13px; color: var(--text-sec); }
.info-val { font-size: 15px; font-weight: 700; color: var(--text); }
.info-title { font-size: 12px; font-weight: 700; color: var(--accent); text-transform: uppercase; margin: 12px 0 6px; padding-left: 4px; }

.emi-bar-wrap { height: 8px; width: 100%; background: var(--emi-principal); border-radius: 4px; overflow: hidden; margin: 10px 0 4px; display: flex; }
.emi-bar-interest { height: 100%; background: var(--emi-interest); width: 0%; transition: width 0.5s ease; }
.emi-legend { display: flex; justify-content: space-between; font-size: 10px; color: var(--text-sec); }
.dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 4px; }
.rate-info { font-size: 10px; color: var(--text-sec); text-align: right; margin-top: 4px; }

.footer-credit { position: fixed; bottom: 25px; width: 100%; text-align: center; font-size: 16px; color: var(--text-sec); pointer-events: none; transition: opacity 0.2s; z-index: 100; }
</style>
</head>

<body>
<div id="welcomeSplash" class="welcome-overlay">
  <div class="welcome-logo">Daily Life Calculator App</div>
  <div class="welcome-tagline">By Aditya</div>
</div>

<div class="bg-mesh"></div>
<div class="floater f1"></div><div class="floater f2"></div><div class="floater f3"></div>

<script>
    /* --- THEME SYNC LOGIC --- */
    function applyTheme(isDark) { 
        if(isDark) { 
            document.body.classList.add('dark'); 
            const btn = document.getElementById('settingThemeBtn'); 
            if(btn) btn.innerHTML = '<i class="ph-bold ph-sun"></i> Light'; 
        } else { 
            document.body.classList.remove('dark'); 
            const btn = document.getElementById('settingThemeBtn'); 
            if(btn) btn.innerHTML = '<i class="ph-bold ph-moon"></i> Dark'; 
        } 
    }

    const systemDark = window.matchMedia('(prefers-color-scheme: dark)');
    applyTheme(systemDark.matches);
    systemDark.addEventListener('change', (e) => { 
        if(!localStorage.getItem('dlc_manual_theme')) {
            applyTheme(e.matches); 
        }
    });

    function toggleTheme() { 
        const isDarkNow = document.body.classList.contains('dark');
        applyTheme(!isDarkNow); 
        localStorage.setItem('dlc_manual_theme', 'true');
        localStorage.setItem('dlc_theme', !isDarkNow ? 'dark' : 'light');
    }

    /* --- SOUND & VOICE LOGIC --- */
    let audioCtx;
    let isMuted = localStorage.getItem('dlc_muted') === 'true';

    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    function playClick() {
        if (isMuted) return;
        initAudio();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.value = 800;
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
        if (navigator.vibrate) navigator.vibrate(10); 
    }

    function playTrash() {
        if (isMuted) return;
        initAudio();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.value = 150;
        osc.type = 'sawtooth';
        gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    function toggleSound() { 
        isMuted = !isMuted; 
        localStorage.setItem('dlc_muted', isMuted); 
        const btn = document.getElementById('settingSoundBtn');
        if(btn) btn.innerHTML = isMuted ? '<i class="ph-bold ph-speaker-slash"></i> Off' : '<i class="ph-bold ph-speaker-high"></i> On';
        if(!isMuted) playClick(); 
    }

    function readResult(secId) {
        if (isMuted) return;
        initAudio();
        let text = "";
        if (secId === 'rate') {
            const totalVal = document.getElementById('total').innerText;
            const resVal = document.getElementById('result').innerText;
            text = isEn ? `Total Price is ${totalVal}. You will get ${resVal}` : `‡¶Æ‡ßã‡¶ü ‡¶¶‡¶æ‡¶Æ ${totalVal} ‡¶ü‡¶æ‡¶ï‡¶æ‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶® ${resVal}`;
        } else if (secId === 'fuel') {
            const cost = document.getElementById('resFCost').innerText;
            const fuel = document.getElementById('resFFuel').innerText;
            text = isEn ? `Total fuel cost is ${cost} rupees. Required fuel is ${fuel}` : `‡¶Æ‡ßã‡¶ü ‡¶§‡ßá‡¶≤‡ßá‡¶∞ ‡¶ñ‡¶∞‡¶ö ${cost} ‡¶ü‡¶æ‡¶ï‡¶æ‡•§ ‡¶§‡ßá‡¶≤ ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá ${fuel}`;
        } else if (secId === 'age') {
            const y = document.getElementById('resYears').innerText;
            const m = document.getElementById('resMonths').innerText;
            const d = document.getElementById('resDays').innerText;
            text = isEn ? `Your age is ${y} years, ${m} months, and ${d} days` : `‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßü‡¶∏ ${y} ‡¶¨‡¶õ‡¶∞, ${m} ‡¶Æ‡¶æ‡¶∏, ‡¶è‡¶¨‡¶Ç ${d} ‡¶¶‡¶ø‡¶®`;
        } else if (secId === 'emi') {
            const emi = document.getElementById('resEmi').innerText;
            text = isEn ? `Monthly E.M.I. is ${emi} rupees` : `‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá ${emi} ‡¶ü‡¶æ‡¶ï‡¶æ`;
        } else if (secId === 'cash') {
            const cash = document.getElementById('resCashTotal').innerText;
            text = isEn ? `Total amount is ${cash}` : `‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ${cash}`;
        } else if (secId === 'percent') {
            const res = document.getElementById('pcRes').innerText;
            text = isEn ? `Calculation result is ${res}` : `‡¶π‡¶ø‡¶∏‡¶æ‡¶¨‡ßá‡¶∞ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶π‡¶≤‡ßã ${res}`;
        } else if (secId === 'converter') {
            const out = document.getElementById('cvOut').value;
            const unit = document.getElementById('cvUnitTo').value;
            text = isEn ? `Converted result is ${out} ${unit}` : `‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶π‡¶≤‡ßã ${out} ${unit}`;
        } else if (secId === 'currency') {
            const res = document.getElementById('curResult').innerText;
            text = isEn ? `Converted amount is ${res}` : `‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶§ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶π‡¶≤‡ßã ${res}`;
        }

        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = isEn ? 'en-IN' : 'bn-IN';
            utterance.rate = 1.0;
            window.speechSynthesis.speak(utterance);
        }
    }

    function saveUserName() {
        const name = document.getElementById('userNameInput').value;
        localStorage.setItem('dlc_username', name);
        updateClocks();
    }
</script>

<button class="ui-btn settings-btn" id="setBtn" onclick="toggleSettings(); playClick()"><i class="ph-bold ph-gear"></i></button>
<button class="ui-btn home-nav-btn" id="homeNavBtn" onclick="showSection('home'); playClick()"><i class="ph-bold ph-house"></i></button>
<div class="ui-btn hamburger" onclick="toggleMenu(); playClick()"><span></span><span></span><span></span></div>

<div class="modal-overlay" id="modalOverlay" onclick="toggleSettings()"></div>
<div class="settings-modal" id="settingsModal">
  <div class="setting-item">
    <span>Your Name</span>
    <input type="text" id="userNameInput" placeholder="Enter name" oninput="saveUserName()" style="width: 80px; height: 30px; font-size: 11px; text-align: center; border-radius: 8px;">
  </div>
  <div class="setting-item">
    <span>Accent Color</span>
    <input type="color" id="accentPicker" oninput="changeAccent(this.value)" style="width: 40px; height: 30px; border: none; background: transparent; cursor: pointer;">
  </div>
  <div class="setting-item">
    <span>Language</span>
    <button class="mini-btn" onclick="toggleGlobalLang(); playClick()" id="settingLangBtn"><i class="ph-bold ph-globe"></i> EN</button>
  </div>
  <div class="setting-item">
    <span>Sound</span>
    <button class="mini-btn" onclick="toggleSound();" id="settingSoundBtn"><i class="ph-bold ph-speaker-high"></i> On</button>
  </div>
  <div class="setting-item">
    <span>Theme</span>
    <button class="mini-btn" onclick="toggleTheme(); playClick()" id="settingThemeBtn"><i class="ph-bold ph-moon"></i> Dark</button>
  </div>
</div>

<div class="side-menu">
 <div class="menu-version-top">v1.2.5</div> 
 <div style="font-size:24px; font-weight:700; margin-bottom:20px; padding-left:10px;">Menu</div>
 <div id="menuList">
     <button onclick="onMenuClick('home'); playClick()"><i class="ph-bold ph-house"></i> Home</button>
     <button onclick="onMenuClick('rate'); playClick()"><i class="ph-bold ph-scales"></i> Price Calculator</button>
     <button onclick="onMenuClick('fuel'); playClick()"><i class="ph-bold ph-gas-pump"></i> Fuel Calculator</button>
     <button onclick="onMenuClick('age'); playClick()"><i class="ph-bold ph-cake"></i> Age Calculator</button>
     <button onclick="onMenuClick('emi'); playClick()"><i class="ph-bold ph-bank"></i> EMI Calculator</button>
     <button onclick="onMenuClick('currency'); playClick()"><i class="ph-bold ph-currency-circle-dollar"></i> Currency Converter</button>
     <button onclick="onMenuClick('percent'); playClick()"><i class="ph-bold ph-percent"></i> Percentage Calculator</button>
     <button onclick="onMenuClick('converter'); playClick()"><i class="ph-bold ph-arrows-left-right"></i> Unit Converter</button>
     <button onclick="onMenuClick('cash'); playClick()"><i class="ph-bold ph-money"></i> Cash Counter</button>
 </div>
</div>
<div class="overlay" onclick="toggleMenu()"></div>

<section id="home" class="section active">
 <div class="greeting" id="greeting">Hello</div>
 <div class="clock-wrap">
  <div class="ring-clock">
   <svg viewBox="0 0 280 280"><circle class="hour" cx="140" cy="140" r="110" stroke-width="12"/><circle class="min" cx="140" cy="140" r="95" stroke-width="12"/><circle class="sec" cx="140" cy="140" r="80" stroke-width="12"/></svg>
   <div class="digital-wrap">
     <div class="digital" id="time">00:00</div>
     <div class="date" id="date">Loading...</div>
     <div class="bn-date" id="bnCalendar">...</div>
   </div>
  </div>
 </div>
 <div class="quick-links">
     <div class="q-card" onclick="showSection('rate'); playClick()"><div class="q-icon"><i class="ph-duotone ph-scales"></i></div><div class="q-name">Price</div></div>
     <div class="q-card" onclick="showSection('fuel'); playClick()"><div class="q-icon"><i class="ph-duotone ph-gas-pump"></i></div><div class="q-name">Fuel</div></div>
     <div class="q-card" onclick="showSection('age'); playClick()"><div class="q-icon"><i class="ph-duotone ph-cake"></i></div><div class="q-name">Age</div></div>
 </div>
</section>

<section id="rate" class="section">
 <div class="mini-clock"><div class="mc-card mc-h">12</div><div class="mc-sep">:</div><div class="mc-card mc-m">00</div><div class="mc-sep">:</div><div class="mc-card mc-s" style="color:var(--c-sec)">00</div><div class="mc-ampm">AM</div></div>
 <div class="app">
  <div class="header-row"><h2 id="rateTitle">Price Calculator</h2>
   <div class="btn-group">
    <button class="lang-btn voice-btn" onclick="readResult('rate'); playClick()"><i class="ph-bold ph-speaker-high"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsText('rate'); playClick()"><i class="ph-bold ph-copy"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsImage('rate')"><i class="ph-bold ph-image-square"></i></button>
    <button class="lang-btn undo-btn" onclick="undoData('rate'); playClick()"><i class="ph-bold ph-arrow-u-up-left"></i></button>
    <button class="lang-btn clear-btn" onclick="clearData('rate'); playTrash()"><i class="ph-bold ph-trash"></i></button>
   </div>
  </div>
  <div><label id="lp">Price per Kg</label><input id="price" type="number" inputmode="decimal" placeholder="0"></div>
  <div class="row"><div><label id="lw">Weight</label><input id="weight" type="number" inputmode="decimal" placeholder="0"></div><div><label id="lu">Unit</label><select id="unit"><option value="g">Gram</option><option value="kg">Kg</option></select></div></div>
  <div class="box box-compact"><span id="lt">Total</span><span class="total" id="total">0.00</span></div>
  <div><label id="la">Pay Amount</label><input id="amount" type="number" inputmode="decimal" placeholder="0"></div>
  <div class="box box-compact"><span id="lg">Result</span><span class="total" id="result">0 g</span></div>
 </div>
</section>

<section id="fuel" class="section">
 <div class="mini-clock"><div class="mc-card mc-h">12</div><div class="mc-sep">:</div><div class="mc-card mc-m">00</div><div class="mc-sep">:</div><div class="mc-card mc-s" style="color:var(--c-sec)">00</div><div class="mc-ampm">AM</div></div>
 <div class="app">
  <div class="header-row"><h2 id="fuelTitle">Fuel Calculator</h2>
   <div class="btn-group">
    <button class="lang-btn voice-btn" onclick="readResult('fuel'); playClick()"><i class="ph-bold ph-speaker-high"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsText('fuel'); playClick()"><i class="ph-bold ph-copy"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsImage('fuel')"><i class="ph-bold ph-image-square"></i></button>
    <button class="lang-btn undo-btn" onclick="undoData('fuel'); playClick()"><i class="ph-bold ph-arrow-u-up-left"></i></button>
    <button class="lang-btn clear-btn" onclick="clearData('fuel'); playTrash()"><i class="ph-bold ph-trash"></i></button>
   </div>
  </div>
  <div class="row"><div><label id="lblDist">Distance (km)</label><input id="fuelDist" type="number" inputmode="decimal" placeholder="100"></div><div><label id="lblMil">Mileage (km/L)</label><input id="fuelMil" type="number" inputmode="decimal" placeholder="45"></div></div>
  <div class="row"><div><label id="lblFPrice">Price (per L)</label><input id="fuelPrice" type="number" inputmode="decimal" placeholder="100"></div><div><label id="lblSpeed">Speed (km/h)</label><input id="fuelSpeed" type="number" inputmode="decimal" placeholder="60"></div></div>
  <div class="box" style="margin-top:8px; background: rgba(0,122,255,0.1); border: 1px solid rgba(0,122,255,0.2);"><span id="lblFCost">Total Cost</span><span class="total" id="resFCost" style="font-size: 24px; color: var(--accent);">0.00</span></div>
  <div class="grid-2" style="margin-top:8px;"><div class="box"><span id="lblFFuel">Fuel Needed</span><span class="total" id="resFFuel">0 L</span></div><div class="box"><span id="lblFTime">Est. Time</span><span class="total" id="resFTime">0m</span></div></div>
 </div>
</section>

<section id="age" class="section">
 <div class="mini-clock"><div class="mc-card mc-h">12</div><div class="mc-sep">:</div><div class="mc-card mc-m">00</div><div class="mc-sep">:</div><div class="mc-card mc-s" style="color:var(--c-sec)">00</div><div class="mc-ampm">AM</div></div>
 <div class="app">
  <div class="header-row"><h2 id="ageTitle">Age Calculator</h2>
   <div class="btn-group">
    <button class="lang-btn voice-btn" onclick="readResult('age'); playClick()"><i class="ph-bold ph-speaker-high"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsText('age'); playClick()"><i class="ph-bold ph-copy"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsImage('age')"><i class="ph-bold ph-image-square"></i></button>
    <button class="lang-btn undo-btn" onclick="undoData('age'); playClick()"><i class="ph-bold ph-arrow-u-up-left"></i></button>
    <button class="lang-btn clear-btn" onclick="clearData('age'); playTrash()"><i class="ph-bold ph-trash"></i></button>
   </div>
  </div>
  <div><label id="lblDob">Date of Birth</label><input id="dobInput" type="date"></div>
  <div class="grid-2" style="margin-top:8px;">
    <div class="box"><span id="lblYears">Years</span><span class="total" id="resYears">0</span></div>
    <div class="box"><span id="lblMonths">Months</span><span class="total" id="resMonths">0</span></div>
    <div class="box"><span id="lblDays">Days</span><span class="total" id="resDays">0</span></div>
    <div class="box"><span id="lblNextBday">Next B'day</span><span class="total" id="resNextBday" style="color: #FF9500;">-</span></div>
  </div>
  <div id="funContainer" class="fun-container" style="display:none;">
      <div class="info-title" id="lblDetails">Details</div>
      <div class="info-row"><span class="info-label" id="lblBornDay">Born On</span><span class="info-val" id="resBornDay">-</span></div>
      <div class="info-row"><span class="info-label" id="lblZodiac">Zodiac</span><span class="info-val" id="resZodiac">-</span></div>
      <div class="info-title" id="lblLifeStats">Total Life Stats</div>
      <div class="info-row"><span class="info-label" id="lblTotMonths">Total Months</span><span class="info-val" id="resTotMonths">0</span></div>
      <div class="info-row"><span class="info-label" id="lblTotWeeks">Total Weeks</span><span class="info-val" id="resTotWeeks">0</span></div>
      <div class="info-row"><span class="info-label" id="lblTotDays">Total Days</span><span class="info-val" id="resTotDays">0</span></div>
  </div>
 </div>
</section>

<section id="emi" class="section">
 <div class="mini-clock"><div class="mc-card mc-h">12</div><div class="mc-sep">:</div><div class="mc-card mc-m">00</div><div class="mc-sep">:</div><div class="mc-card mc-s" style="color:var(--c-sec)">00</div><div class="mc-ampm">AM</div></div>
 <div class="app">
  <div class="header-row"><h2 id="emiTitle">EMI Calculator</h2>
   <div class="btn-group">
    <button class="lang-btn voice-btn" onclick="readResult('emi'); playClick()"><i class="ph-bold ph-speaker-high"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsText('emi'); playClick()"><i class="ph-bold ph-copy"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsImage('emi')"><i class="ph-bold ph-image-square"></i></button>
    <button class="lang-btn undo-btn" onclick="undoData('emi'); playClick()"><i class="ph-bold ph-arrow-u-up-left"></i></button>
    <button class="lang-btn clear-btn" onclick="clearData('emi'); playTrash()"><i class="ph-bold ph-trash"></i></button>
   </div>
  </div>
  <div><label id="lblLoan">Loan Amount</label><input id="emiPrincipal" type="number" inputmode="decimal" placeholder="500000"></div>
  <div class="row"><div><label id="lblRate">Interest (%)</label><input id="emiRate" type="number" inputmode="decimal" placeholder="10.5"></div><div><label id="lblYears">Years</label><input id="emiYears" type="number" inputmode="decimal" placeholder="5"></div></div>
  <div class="box" style="background: rgba(0,122,255,0.1); border: 1px solid rgba(0,122,255,0.2);"><span id="lblEmiRes">Monthly EMI</span><span class="total" id="resEmi" style="font-size: 24px; color: var(--accent);">0.00</span></div>
  <div class="emi-bar-wrap"><div id="emiBarInt" class="emi-bar-interest"></div></div>
  <div class="emi-legend"><span><span class="dot" style="background:var(--emi-principal)"></span><span id="txtPrin">Principal</span></span><span><span class="dot" style="background:var(--emi-interest)"></span><span id="txtInt">Interest</span></span></div>
  <div class="grid-2" style="margin-top:8px;"><div class="box"><span id="lblTotalInt">Total Interest</span><span class="total" id="resTotalInt" style="color:var(--emi-interest)">0</span></div><div class="box"><span id="lblTotalPay">Total Payment</span><span class="total" id="resTotalPay">0</span></div></div>
 </div>
</section>

<section id="currency" class="section">
 <div class="mini-clock"><div class="mc-card mc-h">12</div><div class="mc-sep">:</div><div class="mc-card mc-m">00</div><div class="mc-sep">:</div><div class="mc-card mc-s" style="color:var(--c-sec)">00</div><div class="mc-ampm">AM</div></div>
 <div class="app">
  <div class="header-row"><h2 id="curTitle">Currency Converter</h2>
   <div class="btn-group">
    <button class="lang-btn" onclick="refreshCurrencyRates(); playClick()"><i class="ph-bold ph-arrows-clockwise"></i></button>
    <button class="lang-btn voice-btn" onclick="readResult('currency'); playClick()"><i class="ph-bold ph-speaker-high"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsText('currency'); playClick()"><i class="ph-bold ph-copy"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsImage('currency')"><i class="ph-bold ph-image-square"></i></button>
    <button class="lang-btn undo-btn" onclick="undoData('currency'); playClick()"><i class="ph-bold ph-arrow-u-up-left"></i></button>
    <button class="lang-btn clear-btn" onclick="clearData('currency'); playTrash()"><i class="ph-bold ph-trash"></i></button>
   </div>
  </div>
  <div><label id="curLblAmount">Amount</label><input id="curAmount" type="number" inputmode="decimal" placeholder="1" value="1"></div>
  <div class="row"><div><label id="curLblFrom">From</label><select id="curFrom" onchange="convertCurrency(); playClick()"></select></div><button class="swap-btn" onclick="swapCurrency(); playClick()"><i class="ph-bold ph-arrows-left-right"></i></button><div><label id="curLblTo">To</label><select id="curTo" onchange="convertCurrency(); playClick()"></select></div></div>
  <div class="box"><span id="curLblResult">Result</span><span class="total" id="curResult">...</span><div class="rate-info" id="curRateInfo">Fetching rates...</div></div>
 </div>
</section>

<section id="percent" class="section">
 <div class="mini-clock"><div class="mc-card mc-h">12</div><div class="mc-sep">:</div><div class="mc-card mc-m">00</div><div class="mc-sep">:</div><div class="mc-card mc-s" style="color:var(--c-sec)">00</div><div class="mc-ampm">AM</div></div>
 <div class="app">
  <div class="header-row"><h2 id="pcTitle">Percent Calculator</h2>
   <div class="btn-group">
    <button class="lang-btn voice-btn" onclick="readResult('percent'); playClick()"><i class="ph-bold ph-speaker-high"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsText('percent'); playClick()"><i class="ph-bold ph-copy"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsImage('percent')"><i class="ph-bold ph-image-square"></i></button>
    <button class="lang-btn undo-btn" onclick="undoData('percent'); playClick()"><i class="ph-bold ph-arrow-u-up-left"></i></button>
    <button class="lang-btn clear-btn" onclick="clearData('percent'); playTrash()"><i class="ph-bold ph-trash"></i></button>
   </div>
  </div>
  <div><label id="lblType">Mode</label><select id="pcMode" onchange="updatePCLayout(); playClick()"><option value="1">X is what % of Y</option><option value="2">X% of Y</option><option value="3">% Increase/Decrease</option><option value="4">Reverse %</option></select></div>
  <div class="row"><div><label id="pcL1">X Value</label><input id="pcIn1" type="number" inputmode="decimal"></div><div><label id="pcL2">Y Value</label><input id="pcIn2" type="number" inputmode="decimal"></div></div>
  <div class="box"><span id="pcResLabel">Result</span><span class="total" id="pcRes">-</span></div>
 </div>
</section>

<section id="converter" class="section">
 <div class="mini-clock"><div class="mc-card mc-h">12</div><div class="mc-sep">:</div><div class="mc-card mc-m">00</div><div class="mc-sep">:</div><div class="mc-card mc-s" style="color:var(--c-sec)">00</div><div class="mc-ampm">AM</div></div>
 <div class="app">
  <div class="header-row"><h2 id="cvTitle">All-in-One Converter</h2>
   <div class="btn-group">
    <button class="lang-btn voice-btn" onclick="readResult('converter'); playClick()"><i class="ph-bold ph-speaker-high"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsText('converter'); playClick()"><i class="ph-bold ph-copy"></i></button>
    <button class="lang-btn share-btn" onclick="shareAsImage('converter')"><i class="ph-bold ph-image-square"></i></button>
    <button class="lang-btn undo-btn" onclick="undoData('converter'); playClick()"><i class="ph-bold ph-arrow-u-up-left"></i></button>
    <button class="lang-btn clear-btn" onclick="clearData('converter'); playTrash()"><i class="ph-bold ph-trash"></i></button>
   </div>
  </div>
  <div><label id="cvLblCat">Category</label><select id="cvCat" onchange="updateCvUnits(); playClick()"><option value="len">Length</option><option value="wgt">Weight</option><option value="temp">Temperature</option><option value="time">Time</option><option value="speed">Speed</option><option value="data">Data</option><option value="power">Power</option><option value="land">Indian Land</option></select></div>
  <div class="row"><div style="flex:1.5;"><label id="cvLblFrom">From</label><input id="cvIn" type="number" inputmode="decimal" placeholder="0"></div><div style="flex:1;"><label>&nbsp;</label><select id="cvUnitFrom" onchange="doConvert(); playClick()"></select></div></div>
  <div class="row"><div style="flex:1.5;"><label id="cvLblTo">To</label><input id="cvOut" type="text" readonly style="background:transparent; font-weight:700; border:1px solid var(--glass-border);"></div><div style="flex:1;"><label>&nbsp;</label><select id="cvUnitTo" onchange="doConvert(); playClick()"></select></div></div>
 </div>
</section>

<section id="cash" class="section">
 <div class="mini-clock"><div class="mc-card mc-h">12</div><div class="mc-sep">:</div><div class="mc-card mc-m">00</div><div class="mc-sep">:</div><div class="mc-card mc-s" style="color:var(--c-sec)">00</div><div class="mc-ampm">AM</div></div>
 <div class="app">
  <div class="header-row"><h2 id="cashTitle">Cash Counter</h2>
   <div class="btn-group">
     <button class="lang-btn voice-btn" onclick="readResult('cash'); playClick()"><i class="ph-bold ph-speaker-high"></i></button>
     <button class="lang-btn share-btn" onclick="shareAsText('cash'); playClick()"><i class="ph-bold ph-copy"></i></button>
     <button class="lang-btn share-btn" onclick="shareAsImage('cash')"><i class="ph-bold ph-image-square"></i></button>
     <button class="lang-btn undo-btn" onclick="undoData('cash'); playClick()"><i class="ph-bold ph-arrow-u-up-left"></i></button>
     <button class="lang-btn clear-btn" onclick="clearCash(); playTrash()"><i class="ph-bold ph-trash"></i></button>
   </div>
  </div>
  <div id="cashList" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;"></div>
  <div class="box" style="background: rgba(52, 199, 89, 0.1); border: 1px solid rgba(52, 199, 89, 0.2);">
    <span id="lblCashTotal">Grand Total</span>
    <span class="total" id="resCashTotal" style="font-size: 26px; color: #34C759;">‚Çπ 0</span>
  </div>
  <div class="rate-info" id="cashInWords" style="text-align: center; margin-top: 8px; font-weight:600;">Zero Rupees Only</div>
 </div>
</section>

<div class="footer-credit">Made with ‚ù§Ô∏è by Aditya</div>

<script>
/* CORE LOGIC */

const historyStack = {};

function saveHistory(secId) {
    const sec = document.getElementById(secId);
    const inputs = sec.querySelectorAll('input, select');
    const state = {};
    inputs.forEach(el => {
        if(el.id) state[el.id] = el.value;
    });
    
    if(!historyStack[secId]) historyStack[secId] = [];
    historyStack[secId].push(JSON.stringify(state));
    
    // ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡¶ø‡¶Æ‡¶æ‡¶Æ ‡ß®‡ß¶‡¶ü‡¶æ ‡¶∏‡ßç‡¶ü‡ßá‡¶™ ‡¶Æ‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá
    if(historyStack[secId].length > 20) historyStack[secId].shift();
}

function undoData(secId) {
    if(!historyStack[secId] || historyStack[secId].length === 0) return;
    
    // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡ßç‡¶ü‡ßá‡¶ü ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü‡¶ü‡¶ø ‡¶®‡¶ø‡¶®
    const lastState = JSON.parse(historyStack[secId].pop());
    
    for (const id in lastState) {
        const el = document.getElementById(id);
        if(el) {
            el.value = lastState[id];
            localStorage.setItem('dlc_' + id, lastState[id]);
        }
    }
    triggerCalc(secId);
    playClick();
}

function changeAccent(color) {
    document.documentElement.style.setProperty('--accent', color);
    localStorage.setItem('dlc_accent', color);
}

async function shareAsImage(secId) {
    playClick();
    const section = document.querySelector(`#${secId} .app`);
    const options = { backgroundColor: document.body.classList.contains('dark') ? '#1e1e1e' : '#f2f2f7', scale: 2, borderRadius: 18, useCORS: true, logging: false };
    try {
        const canvas = await html2canvas(section, options);
        canvas.toBlob(async (blob) => {
            const file = new File([blob], 'calculation_result.png', { type: 'image/png' });
            if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                await navigator.share({ files: [file], title: 'Calculator Result', text: 'Daily Life App ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§' });
            } else {
                const link = document.createElement('a'); link.download = 'result.png'; link.href = URL.createObjectURL(blob); link.click();
            }
        });
    } catch (err) { console.error("Image generation failed", err); }
}

async function shareAsText(secId) {
    let resultText = "";
    const title = document.getElementById(secId + 'Title').innerText;
    if (secId === 'rate') { const t = document.getElementById('total').innerText; const r = document.getElementById('result').innerText; resultText = isEn ? `${title}\nTotal Price: ${t}\nYou will get: ${r}` : `${title}\n‡¶Æ‡ßã‡¶ü ‡¶¶‡¶æ‡¶Æ: ${t}\n‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶®: ${r}`;
    } else if (secId === 'fuel') { const cost = document.getElementById('resFCost').innerText; const fuel = document.getElementById('resFFuel').innerText; resultText = isEn ? `${title}\nTotal Cost: ‚Çπ${cost}\nFuel Needed: ${fuel}` : `${title}\n‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö: ‚Çπ${cost}\n‡¶§‡ßá‡¶≤ ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá: ${fuel}`;
    } else if (secId === 'age') { const y = document.getElementById('resYears').innerText; const m = document.getElementById('resMonths').innerText; const d = document.getElementById('resDays').innerText; resultText = isEn ? `${title}\nYour Age: ${y} Years, ${m} Months, ${d} Days` : `${title}\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßü‡¶∏: ${y} ‡¶¨‡¶õ‡¶∞, ${m} ‡¶Æ‡¶æ‡¶∏, ‡¶è‡¶¨‡¶Ç ${d} ‡¶¶‡¶ø‡¶®`;
    } else if (secId === 'emi') { const emi = document.getElementById('resEmi').innerText; const total = document.getElementById('resTotalPay').innerText; resultText = isEn ? `${title}\nMonthly EMI: ${emi}\nTotal Payment: ${total}` : `${title}\n‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø: ${emi}\n‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß: ${total}`;
    } else if (secId === 'currency') { const res = document.getElementById('curResult').innerText; resultText = isEn ? `${title}\nConverted Amount: ${res}` : `${title}\n‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶§ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: ${res}`;
    } else if (secId === 'percent') { const res = document.getElementById('pcRes').innerText; resultText = isEn ? `${title}\nResult: ${res}` : `${title}\n‡¶´‡¶≤‡¶æ‡¶´‡¶≤: ${res}`;
    } else if (secId === 'converter') { const res = document.getElementById('cvOut').value; const unit = document.getElementById('cvUnitTo').value; resultText = isEn ? `${title}\nResult: ${res} ${unit}` : `${title}\n‡¶´‡¶≤‡¶æ‡¶´‡¶≤: ${res} ${unit}`;
    } else if (secId === 'cash') { const total = document.getElementById('resCashTotal').innerText; const words = document.getElementById('cashInWords').innerText; resultText = isEn ? `${title}\nTotal Cash: ${total}\n${words}` : `${title}\n‡¶Æ‡ßã‡¶ü ‡¶®‡¶ó‡¶¶: ${total}\n${words}`; }
    const finalMsg = `${resultText}\n\nShared via Daily Life Calculator App üì±`;
    if (navigator.share) { try { await navigator.share({ title: title, text: finalMsg }); } catch (err) { console.log("Sharing cancelled"); } } else { navigator.clipboard.writeText(finalMsg); alert(isEn ? "Result copied to clipboard!" : "‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
}

function getBengaliCalendarDate(date) {
    const months = ["‡¶¨‡ßà‡¶∂‡¶æ‡¶ñ", "‡¶ú‡ßç‡¶Ø‡ßà‡¶∑‡ßç‡¶†", "‡¶Ü‡¶∑‡¶æ‡¶¢‡¶º", "‡¶∂‡ßç‡¶∞‡¶æ‡¶¨‡¶£", "‡¶≠‡¶æ‡¶¶‡ßç‡¶∞", "‡¶Ü‡¶∂‡ßç‡¶¨‡¶ø‡¶®", "‡¶ï‡¶æ‡¶∞‡ßç‡¶§‡¶ø‡¶ï", "‡¶Ö‡¶ó‡ßç‡¶∞‡¶π‡¶æ‡¶Ø‡¶º‡¶£", "‡¶™‡ßå‡¶∑", "‡¶Æ‡¶æ‡¶ò", "‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶®", "‡¶ö‡ßà‡¶§‡ßç‡¶∞"];
    const numbers = ["‡ß¶", "‡ßß", "‡ß®", "‡ß©", "‡ß™", "‡ß´", "‡ß¨", "‡ß≠", "‡ßÆ", "‡ßØ"];
    let day = date.getDate(); let month = date.getMonth(); let year = date.getFullYear();
    let bnYear = year - 593; let bnMonth, bnDay;
    if (month === 0) { if (day >= 15) { bnDay = day - 14; bnMonth = "‡¶Æ‡¶æ‡¶ò"; bnYear = year - 594; } else { bnDay = day + 16; bnMonth = "‡¶™‡ßå‡¶∑"; bnYear = year - 594; }
    } else if (month === 1) { if (day >= 14) { bnDay = day - 13; bnMonth = "‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶®"; bnYear = year - 594; } else { bnDay = day + 17; bnMonth = "‡¶Æ‡¶æ‡¶ò"; bnYear = year - 594; }
    } else { bnDay = day; bnMonth = months[month]; bnYear = year - 593; }
    const toBnNum = (n) => n.toString().split('').map(d => numbers[d]).join('');
    return `${toBnNum(bnDay)} ${bnMonth}, ${toBnNum(bnYear)} (‡¶¨‡¶ô‡ßç‡¶ó‡¶æ‡¶¨‡ßç‡¶¶)`;
}

function toggleSettings() {
    initAudio();
    const modal = document.getElementById('settingsModal');
    const overlay = document.getElementById('modalOverlay');
    const btn = document.getElementById('setBtn');
    const active = modal.classList.toggle('active');
    btn.classList.toggle('active'); overlay.style.display = active ? 'block' : 'none';
}

function toggleGlobalLang() { isEn = !isEn; saveLang(); const btn = document.getElementById('settingLangBtn'); if(btn) btn.innerHTML = isEn ? '<i class="ph-bold ph-globe"></i> EN' : '<i class="ph-bold ph-globe"></i> BN'; renderAllLangs(); }

let isEn = localStorage.getItem('lang') !== 'bn'; 
function toggleMenu(){ initAudio(); document.body.classList.toggle('menu-open'); }

function showSection(id){ 
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); 
    const target = document.getElementById(id);
    target.classList.add('active'); 
    document.getElementById('homeNavBtn').style.display = (id === 'home') ? 'none' : 'flex';
}

function onMenuClick(id){ showSection(id); toggleMenu(); }

function toBn(num) { if(isEn) return num; const digits = ['‡ß¶','‡ßß','‡ß®','‡ß©','‡ß™','‡ß´','‡ß¨','‡ß≠','‡ßÆ','‡ßØ']; return num.toString().split('').map(d => digits[d]||d).join(''); }
function saveLang(){ localStorage.setItem('lang',isEn?'en':'bn'); }

const circles={hour:document.querySelector('.hour'),min:document.querySelector('.min'),sec:document.querySelector('.sec')};
Object.values(circles).forEach(c=>{ const r = c.r.baseVal.value; c.len = 2 * Math.PI * r; c.style.strokeDasharray = c.len; });

function updateClocks(){
    const d=new Date(); const hRaw = d.getHours(); const savedName = localStorage.getItem('dlc_username') || "";
    let greet = "";
    if(hRaw >= 5 && hRaw < 12) greet = isEn ? "Good Morning" : "‡¶∂‡ßÅ‡¶≠ ‡¶∏‡¶ï‡¶æ‡¶≤";
    else if(hRaw >= 12 && hRaw < 17) greet = isEn ? "Good Afternoon" : "‡¶∂‡ßÅ‡¶≠ ‡¶¶‡ßÅ‡¶™‡ßÅ‡¶∞";
    else if(hRaw >= 17 && hRaw < 21) greet = isEn ? "Good Evening" : "‡¶∂‡ßÅ‡¶≠ ‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ";
    else greet = isEn ? "Good Night" : "‡¶∂‡ßÅ‡¶≠ ‡¶∞‡¶æ‡¶§‡ßç‡¶∞‡¶ø";
    document.getElementById('greeting').textContent = savedName ? `${greet}, ${savedName}` : greet;
    const h=hRaw%12, m=d.getMinutes(), s=d.getSeconds();
    circles.sec.style.strokeDashoffset = circles.sec.len - (s/60)*circles.sec.len;
    circles.min.style.strokeDashoffset = circles.min.len - ((m+s/60)/60)*circles.min.len;
    circles.hour.style.strokeDashoffset = circles.hour.len - ((h+m/60)/12)*circles.hour.len;
    document.getElementById('time').textContent = d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',hour12:true});
    document.getElementById('date').textContent = d.toLocaleDateString('en-IN',{weekday:'long',day:'numeric',month:'short'});
    document.getElementById('bnCalendar').textContent = getBengaliCalendarDate(d);
    const session = hRaw >= 12 ? "PM" : "AM";
    let h12 = hRaw % 12; h12 = h12 ? h12 : 12; 
    const hh = h12.toString().padStart(2, '0'); const mm = m.toString().padStart(2, '0'); const ss = s.toString().padStart(2, '0');
    document.querySelectorAll('.mini-clock').forEach(mc => { mc.querySelector('.mc-h').textContent = hh; mc.querySelector('.mc-m').textContent = mm; mc.querySelector('.mc-s').textContent = ss; mc.querySelector('.mc-ampm').textContent = session; });
}
setInterval(updateClocks,1000); updateClocks();

Sortable.create(document.getElementById('menuList'), { animation: 250, delay: 150, delayOnTouchOnly: true });

/* CALCULATOR LOGICS */
function renderRateLang(){ rateTitle.textContent=isEn?'Price Calculator':'‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞'; lp.textContent=isEn?'Price per Kg':'‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ï‡ßá‡¶ú‡¶ø ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø'; lw.textContent=isEn?'Weight':'‡¶ì‡¶ú‡¶®'; lu.textContent=isEn?'Unit':'‡¶è‡¶ï‡¶ï'; lt.textContent=isEn?'Total':'‡¶Æ‡ßã‡¶ü ‡¶¶‡¶æ‡¶Æ'; la.textContent=isEn?'Pay Amount':'‡¶Ü‡¶Æ‡¶ø ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡¶æ‡¶á'; lg.textContent=isEn?'Result':'‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶¨‡ßá‡¶®'; calc(); }
function calc(){ let p=+price.value||0, w=+weight.value||0; if(unit.value==='g')w/=1000; total.textContent="‚Çπ "+(p*w).toFixed(2); let a=+amount.value||0; if(p>0){ let g=(a/p)*1000; result.textContent=g>=1000?(g/1000).toFixed(2)+(isEn?' Kg':' ‡¶ï‡ßá‡¶ú‡¶ø'):Math.round(g)+(isEn?' g':' ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ'); } }
['input','change'].forEach(e=>{ price.addEventListener(e,() => {saveHistory('rate'); calc();}); weight.addEventListener(e,() => {saveHistory('rate'); calc();}); unit.addEventListener(e,() => {saveHistory('rate'); calc();}); amount.addEventListener(e,() => {saveHistory('rate'); calc();}); });

function renderAgeLang(){ ageTitle.textContent=isEn?'Age Calculator':'‡¶¨‡ßü‡¶∏ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞'; lblDob.textContent=isEn?'Date of Birth':'‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ'; lblYears.textContent=isEn?'Years':'‡¶¨‡¶õ‡¶∞'; lblMonths.textContent=isEn?'Months':'‡¶Æ‡¶æ‡¶∏'; lblDays.textContent=isEn?'Days':'‡¶¶‡¶ø‡¶®'; lblNextBday.textContent=isEn?'Next B\'day':'‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶ú‡¶®‡ßç‡¶Æ‡¶¶‡¶ø‡¶®'; lblDetails.textContent=isEn?'Details':'‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§'; lblBornDay.textContent=isEn?'Born On':'‡¶ú‡¶®‡ßç‡¶Æ‡¶¨‡¶æ‡¶∞'; lblZodiac.textContent=isEn?'Zodiac':'‡¶∞‡¶æ‡¶∂‡¶ø'; lblLifeStats.textContent=isEn?'Life Statistics':'‡¶ú‡ßÄ‡¶¨‡¶® ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®'; lblTotMonths.textContent=isEn?'Total Months':'‡¶Æ‡ßã‡¶ü ‡¶Æ‡¶æ‡¶∏'; lblTotWeeks.textContent=isEn?'Total Weeks':'‡¶Æ‡ßã‡¶ü ‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π'; lblTotDays.textContent=isEn?'Total Days':'‡¶Æ‡ßã‡¶ü ‡¶¶‡¶ø‡¶®'; doAgeCalc(); }
function getZodiac(d,m){ const signs=["Capricorn","Aquarius","Pisces","Aries","Taurus","Gemini","Cancer","Leo","Virgo","Libra","Scorpio","Sagittarius"]; const days=[20,19,21,20,21,21,23,23,23,23,22,22]; let i=m; if(d<days[m])i=m-1; if(i<0)i=11; return signs[i]; }
function doAgeCalc(){ const v=dobInput.value, funDiv=document.getElementById('funContainer'); if(!v){ funDiv.style.display="none"; return; } const b=new Date(v), n=new Date(); n.setHours(0,0,0,0); b.setHours(0,0,0,0); if(b > n){ resYears.textContent="-"; resMonths.textContent="-"; resDays.textContent="-"; funDiv.style.display="none"; return; } let years = n.getFullYear() - b.getFullYear(); let months = n.getMonth() - b.getMonth(); let days = n.getDate() - b.getDate(); if(days < 0){ months--; days += new Date(n.getFullYear(), n.getMonth(), 0).getDate(); } if(months < 0){ years--; months += 12; } resYears.textContent=toBn(years); resMonths.textContent=toBn(months); resDays.textContent=toBn(days); const currentYear = n.getFullYear(); let nextBday = new Date(currentYear, b.getMonth(), b.getDate()); if(nextBday < n) nextBday.setFullYear(currentYear + 1); const diffTime = Math.abs(nextBday - n); const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); if(diffDays === 0) resNextBday.textContent=isEn?"Today!":"‡¶Ü‡¶ú!"; else resNextBday.textContent = toBn(diffDays) + (isEn?" Days":" ‡¶¶‡¶ø‡¶®"); funDiv.style.display="block"; const dayNames = isEn ? ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'] : ['‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞','‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞','‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤‡¶¨‡¶æ‡¶∞','‡¶¨‡ßÅ‡¶ß‡¶¨‡¶æ‡¶∞','‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞','‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞','‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞']; resBornDay.textContent = dayNames[b.getDay()]; resZodiac.textContent = getZodiac(b.getDate(), b.getMonth()); const totalDiff = n - b; const totalDays = Math.floor(totalDiff / (1000 * 60 * 60 * 24)); const totalWeeks = Math.floor(totalDays / 7); const totalMonths = (years * 12) + months; const fmt = new Intl.NumberFormat(isEn?'en-IN':'bn-IN'); resTotMonths.textContent = toBn(fmt.format(totalMonths)); resTotWeeks.textContent = toBn(fmt.format(totalWeeks)); resTotDays.textContent = toBn(fmt.format(totalDays)); }
dobInput.addEventListener('input',() => {saveHistory('age'); doAgeCalc();});

function renderFuelLang(){ fuelTitle.textContent=isEn?'Fuel Calculator':'‡¶§‡ßá‡¶≤‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨'; lblDist.textContent=isEn?'Distance (km)':'‡¶¶‡ßÇ‡¶∞‡¶§‡ßç‡¶¨ (‡¶ï‡¶ø‡¶Æ‡¶ø)'; lblMil.textContent=isEn?'Mileage (km/L)':'‡¶Æ‡¶æ‡¶á‡¶≤‡ßá‡¶ú (‡¶ï‡¶ø‡¶Æ‡¶ø/‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞)'; lblFPrice.textContent=isEn?'Price (per L)':'‡¶§‡ßá‡¶≤‡ßá‡¶∞ ‡¶¶‡¶æ‡¶Æ (‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞)'; lblSpeed.textContent=isEn?'Avg Speed (km/h)':'‡¶ó‡ßú ‡¶ó‡¶§‡¶ø (‡¶ï‡¶ø‡¶Æ‡¶ø/‡¶ò‡¶£‡ßç‡¶ü‡¶æ)'; lblFCost.textContent=isEn?'Total Cost':'‡¶Æ‡ßã‡¶ü ‡¶ñ‡¶∞‡¶ö'; lblFFuel.textContent=isEn?'Fuel Needed':'‡¶§‡ßá‡¶≤ ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá'; lblFTime.textContent=isEn?'Est. Time':'‡¶∏‡¶Æ‡ßü ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá'; doFuelCalc(); }
function doFuelCalc(){ const d=parseFloat(fuelDist.value)||0, m=parseFloat(fuelMil.value)||0, p=parseFloat(fuelPrice.value)||0, s=parseFloat(fuelSpeed.value)||0; if(d===0||m===0){ resFCost.textContent="0.00"; resFFuel.textContent="-"; resFTime.textContent="-"; return; } const fuelNeeded=d/m, totalCost=fuelNeeded*p; let timeStr="-"; if(s>0){ const timeH=d/s, hrs=Math.floor(timeH), mins=Math.round((timeH-hrs)*60); timeStr=isEn?`${hrs}h ${mins}m`:`${toBn(hrs)}‡¶ò ${toBn(mins)}‡¶Æ‡¶ø`; } const fmt=new Intl.NumberFormat(isEn?'en-IN':'bn-IN',{maximumFractionDigits:2}); resFCost.textContent=toBn(fmt.format(totalCost)); resFFuel.textContent=toBn(fuelNeeded.toFixed(2))+(isEn?" L":" ‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞"); resFTime.textContent=timeStr; }
['fuelDist','fuelMil','fuelPrice','fuelSpeed'].forEach(id => { document.getElementById(id).addEventListener('input', () => {saveHistory('fuel'); doFuelCalc();}); });

function renderEmiLang(){ emiTitle.textContent=isEn?'EMI Calculator':'EMI ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞'; lblLoan.textContent=isEn?'Loan Amount':'‡¶ã‡¶£‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£'; lblRate.textContent=isEn?'Interest Rate (%)':'‡¶∏‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ (%)'; lblYears.textContent=isEn?'Tenure (Years)':'‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡ßÄ‡¶Æ‡¶æ (‡¶¨‡¶õ‡¶∞)'; lblEmiRes.textContent=isEn?'Monthly EMI':'‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶ï‡¶ø‡¶∏‡ßç‡¶§‡¶ø (EMI)'; lblTotalInt.textContent=isEn?'Total Interest':'‡¶Æ‡ßã‡¶ü ‡¶∏‡ßÅ‡¶¶'; lblTotalPay.textContent=isEn?'Total Payment':'‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß'; txtPrin.textContent=isEn?'Principal':'‡¶Ü‡¶∏‡¶≤'; txtInt.textContent=isEn?'Interest':'‡¶∏‡ßÅ‡¶¶'; doEmiCalc(); }
function doEmiCalc(){ const P=parseFloat(emiPrincipal.value)||0, R=parseFloat(emiRate.value)||0, N=parseFloat(emiYears.value)||0; if(P===0||R===0||N===0){ resEmi.textContent="0.00"; resTotalInt.textContent="0"; resTotalPay.textContent="0"; document.getElementById('emiBarInt').style.width="0%"; return; } const r=R/12/100, n=N*12; const emi=(P*r*Math.pow(1+r,n))/(Math.pow(1+r,n)-1); const totalPay=emi*n, totalInt=totalPay-P; const fmt=new Intl.NumberFormat(isEn?'en-IN':'bn-IN',{maximumFractionDigits:0}); resEmi.textContent=toBn(emi.toFixed(2)); resTotalInt.textContent=toBn(fmt.format(totalInt)); resTotalPay.textContent=toBn(fmt.format(totalPay)); const intPerc=(totalInt/totalPay)*100; document.getElementById('emiBarInt').style.width=intPerc+"%"; }
['emiPrincipal','emiRate','emiYears'].forEach(id => { document.getElementById(id).addEventListener('input', () => {saveHistory('emi'); doEmiCalc();}); });

const currencyList = [{code:"USD",en:"USA Dollar",bn:"‡¶Ü‡¶Æ‡ßá‡¶∞‡¶ø‡¶ï‡¶æ‡¶® ‡¶°‡¶≤‡¶æ‡¶∞"},{code:"BDT",en:"Bangladeshi Taka",bn:"‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ‡¶¶‡ßá‡¶∂‡ßÄ ‡¶ü‡¶æ‡¶ï‡¶æ"},{code:"INR",en:"Indian Rupee",bn:"‡¶≠‡¶æ‡¶∞‡¶§‡ßÄ‡¶Ø‡¶º ‡¶∞‡ßÅ‡¶™‡¶ø"},{code:"EUR",en:"Euro",bn:"‡¶á‡¶â‡¶∞‡ßã"},{code:"GBP",en:"UK Pound",bn:"‡¶¨‡ßç‡¶∞‡¶ø‡¶ü‡¶ø‡¶∂ ‡¶™‡¶æ‡¶â‡¶®‡ßç‡¶°"}];
let exchangeRates={}, lastFetch=0;
function renderCurrencyLang(){ curTitle.textContent=isEn?'Currency Converter':'‡¶ï‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶∏‡¶ø ‡¶ï‡¶®‡¶≠‡¶æ‡¶∞‡ßç‡¶ü‡¶æ‡¶∞'; curLblAmount.textContent=isEn?'Amount':'‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£'; populateCurrencySelects(true); }
function populateCurrencySelects(k=false){ curFrom.innerHTML=""; curTo.innerHTML=""; currencyList.forEach(c=>{ const n=isEn?`${c.code}-${c.en}`:`${c.code}-${c.bn}`; curFrom.add(new Option(n,c.code)); curTo.add(new Option(n,c.code)); }); if(!k){curFrom.value="USD"; curTo.value="INR";} convertCurrency(); }
async function convertCurrency() {
    const f = curFrom.value, t = curTo.value, a = parseFloat(curAmount.value);
    if (isNaN(a)) return;
    const n = Date.now();
    if (Object.keys(exchangeRates).length === 0 || (n - lastFetch > 3600000)) {
        try {
            const r = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
            const d = await r.json();
            exchangeRates = d.rates; lastFetch = n;
        } catch (e) { return; }
    }
    const rf = exchangeRates[f], rt = exchangeRates[t];
    if (rf && rt) { curResult.textContent = `${t} ${((a / rf) * rt).toFixed(2)}`; }
}
function swapCurrency(){ const t=curFrom.value; curFrom.value=curTo.value; curTo.value=t; convertCurrency(); }
curAmount.addEventListener('input',() => {saveHistory('currency'); convertCurrency();});

function renderPercentLang(){ pcTitle.textContent=isEn?'Percent Calculator':'‡¶∂‡¶§‡¶ï‡¶∞‡¶æ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨'; updatePCLayout(); }
function updatePCLayout(){ doPercentCalc(); }
function doPercentCalc(){ const v1=parseFloat(pcIn1.value), v2=parseFloat(pcIn2.value); if(isNaN(v1)||isNaN(v2)){ pcRes.textContent='-'; return; } const m=pcMode.value; let r=0; if(m=='1')r=v2===0?0:(v1/v2)*100; else if(m=='2')r=(v1/100)*v2; else if(m=='3')r=v1===0?0:((v2-v1)/v1)*100; else if(m=='4')r=v1/(1+v2/100); pcRes.textContent=(m=='1'||m=='3')?r.toFixed(2)+"%":r.toFixed(2); }
pcIn1.addEventListener('input',() => {saveHistory('percent'); doPercentCalc();});
pcIn2.addEventListener('input',() => {saveHistory('percent'); doPercentCalc();});

const cvData={ len:{en:"Length",bn:"‡¶¶‡ßà‡¶∞‡ßç‡¶ò‡ßç‡¶Ø",units:{m:{en:"Meter",bn:"‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞",val:1},km:{en:"Kilometer",bn:"‡¶ï‡¶ø‡¶Æ‡¶ø",val:1000},cm:{en:"Centimeter",bn:"‡¶∏‡ßá‡¶Æ‡¶ø",val:0.01},in:{en:"Inch",bn:"„Ç§ ‡¶á‡¶û‡ßç‡¶ö‡¶ø",val:0.0254}}}, wgt:{en:"Weight",bn:"‡¶ì‡¶ú‡¶®",units:{kg:{en:"Kilogram",bn:"‡¶ï‡ßá‡¶ú‡¶ø",val:1},g:{en:"Gram",bn:"‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ",val:0.001}}}, temp:{en:"Temp",bn:"‡¶§‡¶æ‡¶™‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶æ",units:{c:{en:"Celsius",bn:"‡¶∏‡ßá‡¶≤‡¶∏‡¶ø‡¶Ø‡¶º‡¶æ‡¶∏"},f:{en:"Fahrenheit",bn:"‡¶´‡¶æ‡¶∞‡ßá‡¶®‡¶π‡¶æ‡¶á‡¶ü"}}} };
function renderCvLang(){ updateCvUnits(true); }
function updateCvUnits(){ const t=cvCat.value, u=cvData[t].units; cvUnitFrom.innerHTML=''; cvUnitTo.innerHTML=''; Object.keys(u).forEach(k=>{ const n=isEn?u[k].en:u[k].bn; cvUnitFrom.add(new Option(n,k)); cvUnitTo.add(new Option(n,k)); }); doConvert(); }
function doConvert(){ const v=parseFloat(cvIn.value); if(isNaN(v)) return; const t=cvCat.value, u1=cvUnitFrom.value, u2=cvUnitTo.value; let r=0; if(t==='temp'){ if(u1===u2)r=v; else if(u1==='c'&&u2==='f')r=(v*9/5)+32; else if(u1==='f'&&u2==='c')r=(v-32)*5/9; cvOut.value=r.toFixed(2); return; } r=(v*cvData[t].units[u1].val)/cvData[t].units[u2].val; cvOut.value=r.toFixed(4); }
cvIn.addEventListener('input',() => {saveHistory('converter'); doConvert();});

const notes = [500, 200, 100, 50, 20, 10, 5, 2, 1];
function initCashCounter() {
    const container = document.getElementById('cashList');
    container.innerHTML = '';
    notes.forEach(n => {
        const row = document.createElement('div'); row.className = 'info-row';
        row.innerHTML = `<div style="display:flex; align-items:center; gap:10px; flex:1;"><span style="font-weight:700; width:40px; color:var(--accent);">‚Çπ${n}</span><input type="number" id="note_${n}" placeholder="0" inputmode="numeric" oninput="saveHistory('cash'); doCashCalc()" style="height:35px; text-align:center; flex:1;"></div><div style="flex:1; text-align:right; font-weight:700; color:var(--text-sec);" id="sub_${n}">0</div>`;
        container.appendChild(row);
    });
}
function doCashCalc() {
    let grandTotal = 0;
    notes.forEach(n => { const qty = parseInt(document.getElementById(`note_${n}`).value) || 0; const sub = qty * n; grandTotal += sub; document.getElementById(`sub_${n}`).textContent = toBn(sub.toLocaleString('en-IN')); });
    document.getElementById('resCashTotal').textContent = (isEn ? "‚Çπ " : "‡ß≥ ") + toBn(grandTotal.toLocaleString('en-IN'));
}
function clearCash() { saveHistory('cash'); notes.forEach(n => document.getElementById(`note_${n}`).value = ''); doCashCalc(); }
function renderCashLang() { doCashCalc(); }

function triggerCalc(secId) {
    if(secId === 'fuel') doFuelCalc(); 
    else if(secId === 'rate') calc(); 
    else if(secId === 'emi') doEmiCalc(); 
    else if(secId === 'currency') convertCurrency(); 
    else if(secId === 'percent') doPercentCalc(); 
    else if(secId === 'converter') doConvert(); 
    else if(secId === 'age') doAgeCalc(); 
    else if(secId === 'cash') doCashCalc();
}

function clearData(secId) {
    saveHistory(secId);
    const sec = document.getElementById(secId);
    sec.querySelectorAll('input').forEach(el => { el.value = ''; localStorage.removeItem('dlc_' + el.id); });
    triggerCalc(secId);
}

function initAutoSave() {
    document.querySelectorAll('input, select').forEach(el => {
        const savedVal = localStorage.getItem('dlc_' + el.id);
        if(savedVal) el.value = savedVal;
        el.addEventListener('change', () => localStorage.setItem('dlc_' + el.id, el.value));
    });
}

function renderAllLangs(){ renderFuelLang(); renderRateLang(); renderPercentLang(); renderCvLang(); renderCurrencyLang(); renderAgeLang(); renderEmiLang(); renderCashLang(); }

window.addEventListener('DOMContentLoaded', () => {
    initCashCounter(); renderAllLangs(); initAutoSave();
    const savedTheme = localStorage.getItem('dlc_theme');
    if(savedTheme) applyTheme(savedTheme === 'dark');
    
    // Welcome screen timeout fix
    const splash = document.getElementById('welcomeSplash');
    setTimeout(() => { 
        splash.classList.add('fade-out');
    }, 2000);
});
</script>
</body>
</html>
